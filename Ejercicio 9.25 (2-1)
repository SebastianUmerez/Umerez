#include <stdio.h>
#include <stdlib.h> // Para rand(), srand()
#include <time.h>   // Para time()

// a) Enumeración para el tipo de lectura
typedef enum {
    TIPO_TEMPERATURA, // 0
    TIPO_PRESION,     // 1
    TIPO_ESTADO       // 2
} TipoLectura;

// b) Unión para almacenar el valor (solo uno activo a la vez)
typedef union {
    float temperatura;   // en grados Celsius
    int presion_kpa;     // en kiloPascales
    long codigo_error;   // código numérico de estado
} ValorLectura;

// c) Estructura principal que combina el tipo y el valor
typedef struct {
    long timestamp;      // Marca de tiempo (segundos desde Epoch)
    TipoLectura tipo;    // Qué tipo de dato se almacena
    ValorLectura valor;  // El dato en sí
} SensorLectura;

// 5. Función para imprimir una lectura de sensor
void imprimirLectura(SensorLectura* p) {
    printf("\n=== Lectura del sensor ===\n");
    printf("Timestamp: %ld\n", p->timestamp);

    // Se imprime el dato según su tipo
    switch (p->tipo) {
        case TIPO_TEMPERATURA:
            printf("Temperatura: %.2f °C\n", p->valor.temperatura);
            break;
        case TIPO_PRESION:
            printf("Presión: %d kPa\n", p->valor.presion_kpa);
            break;
        case TIPO_ESTADO:
            printf("Código de estado: %ld\n", p->valor.codigo_error);
            break;
        default:
            printf("Tipo desconocido.\n");
    }
}

int main(void) {
    // 1. Declaración de la estructura y un puntero a ella
    SensorLectura lecturaActual;
    SensorLectura* pLectura = &lecturaActual;

    // Inicializamos la semilla de números aleatorios
    srand(time(NULL));

    // 2. Asignar el timestamp actual
    lecturaActual.timestamp = time(NULL);

    // 3. Generar un número aleatorio entre 0 y 2 para definir el tipo
    int tipoRandom = rand() % 3;
    lecturaActual.tipo = tipoRandom;

    // 4. Ingreso de datos según el tipo (acceso mediante puntero)
    switch (pLectura->tipo) {
        case TIPO_TEMPERATURA:
            printf("Ingrese la temperatura (°C): ");
            scanf("%f", &pLectura->valor.temperatura);
            break;
        case TIPO_PRESION:
            printf("Ingrese la presión (kPa): ");
            scanf("%d", &pLectura->valor.presion_kpa);
            break;
        case TIPO_ESTADO:
            printf("Ingrese el código de estado (long): ");
            scanf("%ld", &pLectura->valor.codigo_error);
            break;
        default:
            printf("Error: tipo de lectura no válido.\n");
    }

    // 6. Mostrar los datos cargados
    imprimirLectura(pLectura);

    return 0;
}
